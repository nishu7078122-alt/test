<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Adventure</title>

  <!-- External CSS -->
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/responsive.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />

  <style>
    /* ‚úÖ Basic Map Section Styles */
    #map-hotels {
      padding: 40px 20px;
      background: #f7f9fb;
    }
    .map-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: space-around;
    }
    #map {
      flex: 2;
      min-width: 300px;
      height: 450px;
      border-radius: 10px;
      border: 2px solid #ddd;
    }
    .hotels-list {
      flex: 1;
      background: white;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      min-width: 250px;
      max-height: 450px;
      overflow-y: auto;
    }
    .hotels-list h3 {
      text-align: center;
      margin-bottom: 10px;
    }
    .hotels-list ul {
      list-style: none;
      padding: 0;
    }
    .hotels-list li {
      padding: 8px 6px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
    }
    .hotels-list li:hover {
      background: #e8f8f8;
    }
    .controls {
      margin-bottom: 15px;
      text-align: center;
    }
    .btn {
      background: #0078d7;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <!-- ‚úÖ EXISTING CONTENT ABOVE -->
  <!-- (Keep your navbar, hero, weather, events, etc.) -->


  <!-- ‚úÖ MAP & HOTELS SECTION (Updated with Live API) -->
  <section id="map-hotels">
    <div class="title">
      <h1 class="font-color">Explore Nearby</h1>
      <div class="line"></div>
    </div>

    <div class="controls">
      <button class="btn" id="locBtn">üìç Center on My Location</button>
      <select id="radiusSelect">
        <option value="2000">2 km</option>
        <option value="3000" selected>3 km</option>
        <option value="5000">5 km</option>
      </select>
      <span id="status" style="margin-left:10px;color:#555;"></span>
    </div>

    <div class="map-container">
      <div id="map"></div>
      <div class="hotels-list">
        <h3>Nearby Hotels</h3>
        <div id="hotel-loader">Loading...</div>
        <ul id="hotel-list"></ul>
      </div>
    </div>
  </section>


  <!-- ‚úÖ JS: Menu + jQuery + Map Integration -->
  <script src="https://code.jquery.com/jquery-3.6.0.js"></script>

  <!-- ‚úÖ GOOGLE MAPS API with PLACES LIBRARY -->
  <script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAxrsWVw6uUtCODYS98jJICyqAYpfHNOT0&libraries=places&callback=initMap">
  </script>

  <!-- ‚úÖ MAIN MAP SCRIPT -->
  <script>
    let map, infoWindow, service, userMarker;
    let markers = [];

    function initMap() {
      const defaultPos = { lat: 22.5726, lng: 88.3639 }; // Kolkata (fallback)
      map = new google.maps.Map(document.getElementById("map"), {
        center: defaultPos,
        zoom: 13
      });

      infoWindow = new google.maps.InfoWindow();
      service = new google.maps.places.PlacesService(map);

      document.getElementById("locBtn").addEventListener("click", getUserLocation);
      document.getElementById("radiusSelect").addEventListener("change", () => {
        if (userMarker) {
          searchNearbyHotels(userMarker.getPosition());
        }
      });

      getUserLocation(); // Auto load on page start
    }

    function getUserLocation() {
      const status = document.getElementById("status");
      if (navigator.geolocation) {
        status.textContent = "Detecting location...";
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const position = { lat: pos.coords.latitude, lng: pos.coords.longitude };
            map.setCenter(position);
            map.setZoom(14);

            if (userMarker) userMarker.setMap(null);
            userMarker = new google.maps.Marker({
              position,
              map,
              icon: "https://maps.google.com/mapfiles/ms/icons/blue-dot.png",
              title: "You are here"
            });

            infoWindow.setContent("You are here!");
            infoWindow.open(map, userMarker);

            searchNearbyHotels(position);
            status.textContent = "Location found!";
          },
          () => {
            status.textContent = "Unable to fetch your location.";
          }
        );
      } else {
        status.textContent = "Geolocation not supported.";
      }
    }

    function clearMarkers() {
      markers.forEach(m => m.setMap(null));
      markers = [];
    }

    function searchNearbyHotels(location) {
      const loader = document.getElementById("hotel-loader");
      loader.textContent = "Searching nearby hotels...";
      clearMarkers();
      const radius = parseInt(document.getElementById("radiusSelect").value);

      const request = {
        location,
        radius,
        type: ["lodging"]
      };

      service.nearbySearch(request, (results, status) => {
        const list = document.getElementById("hotel-list");
        list.innerHTML = "";

        if (status === google.maps.places.PlacesServiceStatus.OK) {
          results.sort((a, b) => (b.rating || 0) - (a.rating || 0));
          results.forEach((place) => {
            const marker = new google.maps.Marker({
              map,
              position: place.geometry.location,
              title: place.name
            });
            markers.push(marker);

            const li = document.createElement("li");
            li.textContent = `${place.name} ${place.rating ? "‚≠ê" + place.rating : ""}`;
            li.onclick = () => {
              map.panTo(place.geometry.location);
              map.setZoom(15);
              infoWindow.setContent(place.name);
              infoWindow.open(map, marker);
            };
            list.appendChild(li);
          });
          loader.textContent = `${results.length} hotels found.`;
        } else {
          loader.textContent = "No hotels found nearby.";
        }
      });
    }
  </script>

</body>
</html>
